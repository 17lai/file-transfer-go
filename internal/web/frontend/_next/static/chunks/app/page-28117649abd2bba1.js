(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{409:(e,s,t)=>{Promise.resolve().then(t.bind(t,5055))},5055:(e,s,t)=>{"use strict";t.d(s,{default:()=>en});var a=t(5155),l=t(2115),r=t(5695),i=t(888),n=t(2596),o=t(9688);function d(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,o.QP)((0,n.$)(s))}let c=i.bL,m=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.B8,{ref:s,className:d("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...l})});m.displayName=i.B8.displayName;let x=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.l9,{ref:s,className:d("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...l})});x.displayName=i.l9.displayName;let u=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.UC,{ref:s,className:d("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...l})});u.displayName=i.UC.displayName;var h=t(3470),f=t(4416);let p=h.bL;h.l9;let g=h.ZL;h.bm;let b=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(h.hJ,{ref:s,className:d("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...l})});b.displayName=h.hJ.displayName;let v=l.forwardRef((e,s)=>{let{className:t,children:l,...r}=e;return(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{}),(0,a.jsxs)(h.UC,{ref:s,className:d("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[l,(0,a.jsxs)(h.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});v.displayName=h.UC.displayName;let j=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:d("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};j.displayName="DialogHeader";let N=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:d("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};N.displayName="DialogFooter";let w=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(h.hE,{ref:s,className:d("text-lg font-semibold leading-none tracking-tight",t),...l})});w.displayName=h.hE.displayName;let y=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(h.VY,{ref:s,className:d("text-sm text-muted-foreground",t),...l})});y.displayName=h.VY.displayName;var k=t(9708);let C=(0,t(2085).F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),S=l.forwardRef((e,s)=>{let{className:t,variant:l,size:r,asChild:i=!1,...n}=e,o=i?k.DX:"button";return(0,a.jsx)(o,{className:d(C({variant:l,size:r,className:t})),ref:s,...n})});S.displayName="Button";var A=t(9099);function z(){return(0,a.jsxs)("div",{className:"text-center mb-8 sm:mb-12 animate-fade-in-up",children:[(0,a.jsx)("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-4",children:"文件快传"}),(0,a.jsxs)("p",{className:"text-base sm:text-lg text-slate-600 max-w-2xl mx-auto leading-relaxed px-4 mb-4",children:["安全、快速、简单的传输服务",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-sm sm:text-base text-slate-500",children:"支持文件、文字、桌面共享 - 无需注册，即传即用"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsxs)("a",{href:"https://github.com/MatrixSeven/file-transfer-go",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center space-x-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm rounded-lg transition-all duration-200 hover:scale-105 transform border border-slate-200 hover:border-slate-300",children:[(0,a.jsx)(A.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"开源项目"})]}),(0,a.jsx)("a",{href:"https://github.com/MatrixSeven/file-transfer-go",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-slate-400 font-mono hover:text-slate-600 transition-colors duration-200 hover:underline",children:"https://github.com/MatrixSeven/file-transfer-go"})]})]})}var _=t(9869),R=t(1788),F=t(7213),E=t(9803),D=t(227),U=t(9022),L=t(7434);function T(e){let{selectedFiles:s,onFilesChange:t,onGenerateCode:r,pickupCode:i,pickupLink:n,onCopyCode:o,onCopyLink:d,onAddMoreFiles:c,onRemoveFile:m,onClearFiles:x,onReset:u,disabled:h=!1}=e,[p,g]=(0,l.useState)(!1),b=(0,l.useRef)(null),v=(0,l.useCallback)(e=>{e.preventDefault(),g(!0)},[]),j=(0,l.useCallback)(e=>{e.preventDefault(),e.currentTarget.contains(e.relatedTarget)||g(!1)},[]),N=(0,l.useCallback)(e=>{e.preventDefault(),g(!1);let a=Array.from(e.dataTransfer.files);a.length>0&&t([...s,...a])},[s,t]),w=(0,l.useCallback)(e=>{let a=Array.from(e.target.files||[]);a.length>0&&t([...s,...a])},[s,t]),y=(0,l.useCallback)(e=>{let a=s.filter((s,t)=>t!==e);t(a),m&&m(a)},[s,t,m]),k=(0,l.useCallback)(()=>{b.current&&b.current.click()},[]);return 0!==s.length||i?(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsxs)("div",{className:"glass-card rounded-2xl p-4 sm:p-6 animate-fade-in-up",children:[(0,a.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-4 sm:mb-6 gap-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-xl flex items-center justify-center",children:(0,a.jsx)(L.A,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg sm:text-xl font-semibold text-slate-800",children:"已选择文件"}),(0,a.jsxs)("p",{className:"text-slate-500 text-sm",children:[s.length," 个文件准备传输"]})]})]})}),(0,a.jsx)("div",{className:"space-y-3 mb-4 sm:mb-6",children:s.map((e,s)=>{var t;return(0,a.jsxs)("div",{className:"group flex items-center justify-between p-3 sm:p-4 bg-gradient-to-r from-slate-50 to-blue-50 border border-slate-200 rounded-xl hover:shadow-md transition-all duration-200",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 sm:space-x-4 min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center flex-shrink-0",children:(t=e.type).startsWith("image/")?(0,a.jsx)(F.A,{className:"w-5 h-5 text-white"}):t.startsWith("video/")?(0,a.jsx)(E.A,{className:"w-5 h-5 text-white"}):t.startsWith("audio/")?(0,a.jsx)(D.A,{className:"w-5 h-5 text-white"}):t.includes("zip")||t.includes("rar")?(0,a.jsx)(U.A,{className:"w-5 h-5 text-white"}):(0,a.jsx)(L.A,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-slate-800 truncate text-sm sm:text-base",children:e.name}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-slate-500",children:(e=>{if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(e.size)})]})]}),(0,a.jsx)(S,{variant:"ghost",size:"sm",onClick:()=>y(s),disabled:h,className:"opacity-0 group-hover:opacity-100 text-slate-400 hover:text-red-500 hover:bg-red-50 transition-all duration-200 flex-shrink-0 ml-2",children:(0,a.jsx)(f.A,{className:"w-4 h-4"})})]},"".concat(e.name,"-").concat(e.size,"-").concat(s))})}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[!i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(S,{onClick:r,disabled:h||0===s.length,className:"button-primary text-white px-6 sm:px-8 py-3 rounded-xl font-medium flex-1 min-w-0 shadow-lg",children:[(0,a.jsx)(_.A,{className:"w-5 h-5 mr-2"}),"生成取件码"]}),(0,a.jsx)(S,{onClick:c,variant:"outline",disabled:h,className:"px-6 sm:px-8 py-3 rounded-xl font-medium",children:"添加文件"}),(0,a.jsx)(S,{onClick:u,variant:"outline",disabled:h,className:"text-red-600 hover:bg-red-50 px-6 sm:px-8 py-3 rounded-xl font-medium",children:"重新选择"})]}),i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S,{variant:"outline",onClick:c,disabled:h,className:"px-6 py-3 rounded-xl border-slate-300 text-slate-600 hover:bg-slate-50 flex-1",children:"添加更多文件"}),s.length>0&&x&&(0,a.jsx)(S,{variant:"outline",onClick:x,disabled:h,className:"px-6 py-3 rounded-xl border-orange-300 text-orange-600 hover:bg-orange-50",children:"清空文件"})]}),(0,a.jsx)(S,{variant:"outline",onClick:u,disabled:h,className:"px-6 py-3 rounded-xl border-red-300 text-red-600 hover:bg-red-50",children:"关闭房间"})]})]}),i&&(0,a.jsxs)("div",{className:"glass-card rounded-2xl p-4 sm:p-6 md:p-8 animate-fade-in-up",children:[(0,a.jsxs)("div",{className:"text-center mb-4 sm:mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-4 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-2xl flex items-center justify-center animate-float",children:(0,a.jsx)(L.A,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),(0,a.jsx)("h3",{className:"text-xl sm:text-2xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent mb-2",children:"取件码生成成功！"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-slate-600",children:"分享以下信息给接收方"})]}),(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"取件码"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,a.jsx)("div",{className:"flex-1 code-display rounded-xl p-4 sm:p-6 text-center",children:(0,a.jsx)("div",{className:"text-2xl sm:text-3xl font-bold font-mono bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent tracking-wider",children:i})}),(0,a.jsx)(S,{onClick:o,className:"px-4 sm:px-6 py-3 bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl font-medium shadow-lg transition-all duration-200 hover:shadow-xl w-full sm:w-auto",children:"复制"})]})]}),n&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"取件链接"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,a.jsx)("div",{className:"flex-1 code-display rounded-xl p-3 sm:p-4",children:(0,a.jsx)("div",{className:"text-xs sm:text-sm text-slate-700 break-all font-mono",children:n})}),(0,a.jsx)(S,{onClick:d,className:"px-4 sm:px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-medium shadow-lg transition-all duration-200 hover:shadow-xl w-full sm:w-auto",children:"复制"})]})]})]}),(0,a.jsx)("div",{className:"mt-4 sm:mt-6 p-3 sm:p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200",children:(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-slate-600 text-center",children:["\uD83D\uDCA1 ",(0,a.jsx)("span",{className:"font-medium",children:"使用提示："}),"接收方输入取件码或访问取件链接即可下载文件"]})})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-2xl flex items-center justify-center animate-float",children:(0,a.jsx)(_.A,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-2xl font-semibold text-slate-800 mb-2",children:"选择文件"}),(0,a.jsx)("p",{className:"text-slate-600",children:"拖拽文件到下方区域或点击选择文件"})]}),(0,a.jsxs)("div",{className:"upload-area rounded-xl p-6 sm:p-8 md:p-12 text-center cursor-pointer ".concat(p?"drag-active":""),onDragOver:v,onDragLeave:j,onDrop:N,onClick:k,children:[(0,a.jsxs)("div",{className:"transition-all duration-300 ".concat(p?"scale-110":""),children:[(0,a.jsx)("div",{className:"w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-4 sm:mb-6 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(_.A,{className:"w-8 h-8 sm:w-10 sm:h-10 transition-colors duration-300 ".concat(p?"text-blue-600":"text-slate-400")})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-lg sm:text-xl font-medium text-slate-700",children:p?"释放文件":"拖拽文件到这里"}),(0,a.jsxs)("p",{className:"text-sm sm:text-base text-slate-500",children:["或者 ",(0,a.jsx)("span",{className:"text-blue-600 font-medium underline",children:"点击选择文件"})]}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-slate-400 mt-4",children:"支持多个文件同时上传，无大小限制"})]})]}),(0,a.jsx)("input",{ref:b,type:"file",multiple:!0,className:"hidden",onChange:w,disabled:h})]})]})}let M=l.forwardRef((e,s)=>{let{className:t,type:l,...r}=e;return(0,a.jsx)("input",{type:l,className:d("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...r})});M.displayName="Input";let P=e=>{if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]};function O(e){let{onJoinRoom:s,files:t,onDownloadFile:r,transferProgresses:i,isConnected:n,isConnecting:o}=e,[d,c]=(0,l.useState)(""),m=(0,l.useCallback)(e=>{e.preventDefault(),6===d.length&&s(d.toUpperCase())},[d,s]),x=(0,l.useCallback)(e=>{let s=e.target.value.replace(/[^A-Z0-9]/g,"").toUpperCase();s.length<=6&&c(s)},[]);return(n||o)&&0===t.length?(0,a.jsx)("div",{className:"glass-card rounded-2xl p-4 sm:p-6 md:p-8 animate-fade-in-up",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-2xl flex items-center justify-center animate-float",children:(0,a.jsx)(R.A,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-semibold text-slate-800 mb-2",children:"等待文件"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-slate-600 mb-6",children:n?"已连接到房间，等待发送方选择文件...":"正在连接到房间..."}),(0,a.jsx)("div",{className:"flex items-center justify-center space-x-4 mb-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full mr-2 ".concat(n?"bg-emerald-500 animate-pulse":"bg-orange-500 animate-spin")}),(0,a.jsx)("span",{className:"text-sm font-medium ".concat(n?"text-emerald-600":"text-orange-600"),children:n?"连接已建立":"连接中..."})]})}),(0,a.jsx)("div",{className:"flex justify-center space-x-1 mb-6",children:[void 0,void 0,void 0].map((e,s)=>(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"".concat(.1*s,"s")}},s))}),(0,a.jsx)("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200",children:(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-slate-600 text-center",children:["\uD83D\uDCA1 ",(0,a.jsx)("span",{className:"font-medium",children:"提示："}),"房间已连接，发送方清空文件列表后您会看到此界面，等待对方重新选择文件"]})})]})}):t.length>0?(0,a.jsx)("div",{className:"space-y-4 sm:space-y-6",children:(0,a.jsxs)("div",{className:"glass-card rounded-2xl p-4 sm:p-6 animate-fade-in-up",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-4 sm:mb-6 gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-xl flex items-center justify-center",children:(0,a.jsx)(R.A,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg sm:text-xl font-semibold text-slate-800",children:"可下载文件"}),(0,a.jsx)("p",{className:"text-slate-500 text-sm",children:n?(0,a.jsx)("span",{className:"text-emerald-600",children:"✅ 已连接，可以下载文件"}):(0,a.jsx)("span",{className:"text-amber-600",children:"⏳ 正在建立连接..."})})]})]}),(0,a.jsx)("div",{className:"bg-gradient-to-r from-emerald-100 to-teal-100 px-3 sm:px-4 py-2 rounded-full self-start sm:self-center",children:(0,a.jsxs)("span",{className:"text-emerald-700 font-medium text-sm",children:[t.length," 个文件"]})})]}),(0,a.jsx)("div",{className:"space-y-3 sm:space-y-4",children:t.map(e=>{var s;let t=i.find(s=>s.originalFileId===e.id),l=t&&"downloading"===t.status,o=t&&"completed"===t.status;return(0,a.jsxs)("div",{className:"bg-gradient-to-r from-slate-50 to-blue-50 border border-slate-200 rounded-xl p-3 sm:p-4 hover:shadow-md transition-all duration-200",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-3 gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 sm:space-x-4 flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center flex-shrink-0",children:(s=e.type).startsWith("image/")?(0,a.jsx)(F.A,{className:"w-5 h-5 text-white"}):s.startsWith("video/")?(0,a.jsx)(E.A,{className:"w-5 h-5 text-white"}):s.startsWith("audio/")?(0,a.jsx)(D.A,{className:"w-5 h-5 text-white"}):s.includes("zip")||s.includes("rar")?(0,a.jsx)(U.A,{className:"w-5 h-5 text-white"}):(0,a.jsx)(L.A,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-medium text-slate-800 truncate text-sm sm:text-base",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:P(e.size)}),o&&(0,a.jsx)("p",{className:"text-xs text-emerald-600 font-medium",children:"✅ 下载完成"})]})]}),(0,a.jsxs)(S,{onClick:()=>r(e.id),disabled:!n||l||o,className:"px-6 py-2 rounded-lg font-medium shadow-lg transition-all duration-200 hover:shadow-xl ".concat(o?"bg-slate-300 text-slate-500 cursor-not-allowed":"bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white"),children:[(0,a.jsx)(R.A,{className:"w-4 h-4 mr-2"}),l?"下载中...":o?"已完成":"下载"]})]}),t&&("downloading"===t.status||"completed"===t.status)&&(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm text-slate-600",children:[(0,a.jsx)("span",{children:"completed"===t.status?"下载完成":"正在下载..."}),(0,a.jsxs)("span",{className:"font-medium",children:[t.progress.toFixed(1),"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-slate-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat("completed"===t.status?"bg-gradient-to-r from-emerald-500 to-emerald-600":"bg-gradient-to-r from-emerald-500 to-teal-500"),style:{width:"".concat(t.progress,"%")}})}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-slate-500",children:[(0,a.jsxs)("span",{children:[P(t.receivedSize)," / ",P(t.totalSize)]}),"downloading"===t.status&&(0,a.jsxs)("span",{children:["预计还需 ",Math.ceil((t.totalSize-t.receivedSize)/1024/1024)," MB"]})]})]})]},e.id)})})]})}):(0,a.jsxs)("div",{className:"glass-card rounded-2xl p-4 sm:p-6 md:p-8 animate-fade-in-up",children:[(0,a.jsxs)("div",{className:"text-center mb-6 sm:mb-8",children:[(0,a.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-4 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-2xl flex items-center justify-center animate-float",children:(0,a.jsx)(R.A,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-semibold text-slate-800 mb-2",children:"输入取件码"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-slate-600",children:"请输入6位取件码来获取文件"})]}),(0,a.jsxs)("form",{onSubmit:m,className:"space-y-4 sm:space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(M,{value:d,onChange:x,placeholder:"请输入取件码",className:"text-center text-2xl sm:text-3xl tracking-[0.3em] sm:tracking-[0.5em] font-mono h-12 sm:h-16 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:ring-emerald-500 bg-white/80 backdrop-blur-sm pb-2 sm:pb-4",maxLength:6,disabled:o}),(0,a.jsx)("div",{className:"absolute inset-x-0 -bottom-4 sm:-bottom-6 flex justify-center space-x-1 sm:space-x-2",children:[...Array(6)].map((e,s)=>(0,a.jsx)("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full transition-all duration-200 ".concat(s<d.length?"bg-emerald-500":"bg-slate-300")},s))})]}),(0,a.jsx)("div",{className:"h-3 sm:h-4"}),(0,a.jsxs)("p",{className:"text-center text-xs sm:text-sm text-slate-500",children:[d.length,"/6 位"]})]}),(0,a.jsx)(S,{type:"submit",className:"w-full h-10 sm:h-12 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white text-base sm:text-lg font-medium rounded-xl shadow-lg transition-all duration-200 hover:shadow-xl hover:scale-105 disabled:opacity-50 disabled:scale-100",disabled:6!==d.length||o,children:o?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"连接中..."})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(R.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"开始接收"})]})})]}),(0,a.jsx)("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200",children:(0,a.jsxs)("p",{className:"text-sm text-slate-600 text-center",children:["\uD83D\uDCA1 ",(0,a.jsx)("span",{className:"font-medium",children:"提示："}),"取件码由发送方提供，有效期为24小时"]})})]})}function B(e){let{selectedFiles:s,onFilesChange:t,onGenerateCode:i,pickupCode:n,pickupLink:o,onCopyCode:d,onCopyLink:c,onAddMoreFiles:m,onRemoveFile:x,onClearFiles:u,onReset:h,onJoinRoom:f,receiverFiles:p,onDownloadFile:g,transferProgresses:b,isConnected:v,isConnecting:j,disabled:N=!1}=e,w=(0,r.useSearchParams)(),y=(0,r.useRouter)(),[k,C]=(0,l.useState)("send");(0,l.useEffect)(()=>{let e=w.get("mode");"file"===w.get("type")&&e&&["send","receive"].includes(e)&&C(e)},[w]);let A=(0,l.useCallback)(e=>{C(e);let s=new URLSearchParams(w.toString());s.set("type","file"),s.set("mode",e),y.push("?".concat(s.toString()),{scroll:!1})},[w,y]);return(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-center mb-6",children:(0,a.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-1 shadow-lg",children:[(0,a.jsxs)(S,{variant:"send"===k?"default":"ghost",onClick:()=>A("send"),className:"px-6 py-2 rounded-lg",children:[(0,a.jsx)(_.A,{className:"w-4 h-4 mr-2"}),"发送文件"]}),(0,a.jsxs)(S,{variant:"receive"===k?"default":"ghost",onClick:()=>A("receive"),className:"px-6 py-2 rounded-lg",children:[(0,a.jsx)(R.A,{className:"w-4 h-4 mr-2"}),"接收文件"]})]})}),"send"===k?(0,a.jsx)("div",{className:"animate-fade-in-up",children:(0,a.jsx)(T,{selectedFiles:s,onFilesChange:t,onGenerateCode:i,pickupCode:n,pickupLink:o,onCopyCode:d,onCopyLink:c,onAddMoreFiles:m,onRemoveFile:x,onClearFiles:u,onReset:h,disabled:N})}):(0,a.jsx)("div",{className:"animate-fade-in-up",children:(0,a.jsx)(O,{onJoinRoom:f,files:p,onDownloadFile:g,transferProgresses:b,isConnected:v,isConnecting:j})})]})}var W=t(2486),I=t(1497),J=t(7580),V=t(4357),q=t(8164),G=t(6801);function X(e){let{onSendText:s,onReceiveText:t,websocket:i,isConnected:n=!1,currentRole:o,pickupCode:d,onCreateWebSocket:c}=e,m=(0,r.useSearchParams)(),x=(0,r.useRouter)(),[u,h]=(0,l.useState)("send"),[f,p]=(0,l.useState)(""),[g,b]=(0,l.useState)(""),[v,j]=(0,l.useState)(""),[N,w]=(0,l.useState)(!1),[y,k]=(0,l.useState)(!1),[C,A]=(0,l.useState)(0),[z,_]=(0,l.useState)([]),{showToast:E}=(0,G.d)(),D=(0,l.useRef)(null),U=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=m.get("mode"),s=m.get("type"),a=m.get("code");"text"===s&&e&&["send","receive"].includes(e)&&(h(e),"receive"===e&&a&&6===a.length&&(b(a.toUpperCase()),setTimeout(()=>{t&&L(a.toUpperCase())},500)))},[m]);let L=(0,l.useCallback)(async e=>{if(e&&6===e.length){w(!0);try{if(t){let s=await t(e);s&&(j(s),E("自动加入房间成功！","success"),c&&c(e,"receiver"))}}catch(e){console.error("自动加入房间失败:",e)}finally{w(!1)}}},[t,c,E]);(0,l.useEffect)(()=>{if(!i)return;let e=e=>{try{var s,t,a,l,r;let i=JSON.parse(e.data);switch(console.log("TextTransfer收到消息:",i),i.type){case"text-update":(null==(s=i.payload)?void 0:s.text)!==void 0&&(j(i.payload.text),"receiver"===o&&p(i.payload.text));break;case"text-send":(null==(t=i.payload)?void 0:t.text)&&(j(i.payload.text),E("收到新的文字内容！","success"));break;case"image-send":(null==(a=i.payload)?void 0:a.imageData)&&(_(e=>[...e,i.payload.imageData]),E("收到新的图片！","success"));break;case"room-status":(null==(l=i.payload)?void 0:l.sender_count)!==void 0&&(null==(r=i.payload)?void 0:r.receiver_count)!==void 0&&A(i.payload.sender_count+i.payload.receiver_count)}}catch(e){console.error("解析WebSocket消息失败:",e)}};return i.addEventListener("message",e),()=>i.removeEventListener("message",e)},[i,o,E]);let T=(0,l.useCallback)(e=>{h(e);let s=new URLSearchParams(m.toString());s.set("type","text"),s.set("mode",e),x.push("?".concat(s.toString()),{scroll:!1})},[m,x]),P=(0,l.useCallback)(e=>{i&&n&&y&&(U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{i.send(JSON.stringify({type:"text-update",payload:{text:e}}))},300))},[i,n,y]),O=(0,l.useCallback)(e=>{let s=e.target.value;p(s),"sender"===o&&y&&P(s)},[o,y,P]),B=(0,l.useCallback)(async()=>{if(!f.trim())return void E("请输入要传输的文字内容","error");w(!0);try{if(s){let e=await s(f);e&&(b(e),k(!0),E("房间创建成功！","success"),c&&c(e,"sender"))}}catch(e){console.error("创建房间失败:",e)}finally{w(!1)}},[f,s,c,E]),X=(0,l.useCallback)(async()=>{if(!g.trim()||6!==g.length)return void E("请输入正确的6位房间码","error");w(!0);try{if(t){let e=await t(g);e&&(j(e),E("成功加入房间！","success"),c&&c(g,"receiver"))}}catch(e){console.error("加入房间失败:",e)}finally{w(!1)}},[g,t,c,E]),K=(0,l.useCallback)(()=>{i&&n&&f.trim()&&(i.send(JSON.stringify({type:"text-send",payload:{text:f}})),E("文字已发送！","success"))},[i,n,f,E]),H=(0,l.useCallback)(e=>{var s;let t=null==(s=e.clipboardData)?void 0:s.items;if(t)for(let e=0;e<t.length;e++){let s=t[e];if(-1!==s.type.indexOf("image")){let e=s.getAsFile();if(e){let s=new FileReader;s.onload=e=>{var s;let t=null==(s=e.target)?void 0:s.result;_(e=>[...e,t]),i&&n&&(i.send(JSON.stringify({type:"image-send",payload:{imageData:t}})),E("图片已发送！","success"))},s.readAsDataURL(e)}}}},[i,n,E]),$=(0,l.useCallback)(async e=>{try{await navigator.clipboard.writeText(e),E("已复制到剪贴板！","success")}catch(e){E("复制失败","error")}},[E]),Y=(0,l.useCallback)(async e=>{let s=window.location.origin+window.location.pathname,t="".concat(s,"?type=text&mode=receive&code=").concat(e);await $(t)},[$]);return(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-center mb-6",children:(0,a.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-1 shadow-lg",children:[(0,a.jsxs)(S,{variant:"send"===u?"default":"ghost",onClick:()=>T("send"),className:"px-6 py-2 rounded-lg",children:[(0,a.jsx)(W.A,{className:"w-4 h-4 mr-2"}),"发送文字"]}),(0,a.jsxs)(S,{variant:"receive"===u?"default":"ghost",onClick:()=>T("receive"),className:"px-6 py-2 rounded-lg",children:[(0,a.jsx)(R.A,{className:"w-4 h-4 mr-2"}),"接收文字"]})]})}),"send"===u?(0,a.jsxs)("div",{className:"glass-card rounded-2xl p-4 sm:p-6 animate-fade-in-up",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-2xl flex items-center justify-center animate-float",children:(0,a.jsx)(I.A,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-semibold text-slate-800 mb-2",children:"传送文字"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-slate-600",children:y?"实时编辑，对方可以同步看到":"输入要传输的文本内容"}),(0,a.jsx)("div",{className:"mt-2 space-y-1",children:y&&(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat(n?"bg-emerald-500 animate-pulse":"bg-red-500")}),(0,a.jsx)("span",{className:n?"text-emerald-600":"text-red-600",children:n?"实时连接已建立":"连接断开"})]}),C>0&&(0,a.jsxs)("div",{className:"flex items-center text-blue-600",children:[(0,a.jsx)(J.A,{className:"w-4 h-4 mr-1"}),C," 人在线"]})]})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("textarea",{ref:D,value:f,onChange:O,onPaste:H,placeholder:"在这里输入要传输的文本内容...  \uD83D\uDCA1 提示：支持实时同步编辑，可以直接粘贴图片 (Ctrl+V)",className:"w-full min-h-[150px] p-4 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-blue-500 bg-white/80 backdrop-blur-sm resize-none",disabled:N}),y&&n&&(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1 bg-emerald-100 text-emerald-700 px-2 py-1 rounded-lg text-xs",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{children:"实时同步"})]})}),y&&!n&&(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1 bg-orange-100 text-orange-700 px-2 py-1 rounded-lg text-xs",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),(0,a.jsx)("span",{children:"连接中..."})]})})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm text-slate-500",children:[(0,a.jsxs)("span",{children:[f.length," 字符"]}),(0,a.jsx)("span",{children:"最大 50,000 字符"})]}),y?(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)("div",{className:"p-4 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl border border-emerald-200",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-emerald-700 mb-2",children:"房间码"}),(0,a.jsx)("div",{className:"text-2xl font-bold font-mono text-emerald-600 mb-3",children:g}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 justify-center",children:[(0,a.jsxs)(S,{onClick:()=>$(g),size:"sm",className:"bg-emerald-500 hover:bg-emerald-600 text-white",children:[(0,a.jsx)(V.A,{className:"w-4 h-4 mr-2"}),"复制房间码"]}),(0,a.jsxs)(S,{onClick:()=>Y(g),size:"sm",className:"bg-purple-500 hover:bg-purple-600 text-white",children:[(0,a.jsx)(q.A,{className:"w-4 h-4 mr-2"}),"复制链接"]}),(0,a.jsxs)(S,{onClick:K,size:"sm",className:"bg-blue-500 hover:bg-blue-600 text-white",disabled:!f.trim(),children:[(0,a.jsx)(W.A,{className:"w-4 h-4 mr-2"}),"发送文字"]})]})]})})}):(0,a.jsx)(S,{onClick:B,disabled:!f.trim()||f.length>5e4||N,className:"w-full h-12 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white text-lg font-medium rounded-xl shadow-lg",children:N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"创建房间..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(W.A,{className:"w-5 h-5 mr-2"}),"创建文字传输房间"]})}),z.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-slate-800 mb-3 flex items-center",children:[(0,a.jsx)(F.A,{className:"w-5 h-5 mr-2"}),"已发送的图片 (",z.length,")"]}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:z.map((e,s)=>(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("img",{src:e,alt:"图片 ".concat(s+1),className:"w-full h-24 object-cover rounded-lg border-2 border-slate-200 hover:border-blue-400 transition-colors cursor-pointer",onClick:()=>window.open(e,"_blank")}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-opacity rounded-lg"})]},s))})]})]})]}):(0,a.jsxs)("div",{className:"glass-card rounded-2xl p-4 sm:p-6 animate-fade-in-up",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-4 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-2xl flex items-center justify-center animate-float",children:(0,a.jsx)(R.A,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-semibold text-slate-800 mb-2",children:"接收文字"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-slate-600",children:"输入6位房间码来获取文字内容"}),(v||f)&&(0,a.jsx)("div",{className:"mt-2 space-y-1",children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat(n?"bg-emerald-500 animate-pulse":"bg-red-500")}),(0,a.jsx)("span",{className:n?"text-emerald-600":"text-red-600",children:n?"实时连接已建立":"连接断开"})]}),C>0&&(0,a.jsxs)("div",{className:"flex items-center text-blue-600",children:[(0,a.jsx)(J.A,{className:"w-4 h-4 mr-1"}),C," 人在线"]})]})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(M,{value:g,onChange:e=>b(e.target.value.toUpperCase().slice(0,6)),placeholder:"请输入房间码",className:"text-center text-2xl sm:text-3xl tracking-[0.3em] sm:tracking-[0.5em] font-mono h-12 sm:h-16 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:ring-emerald-500 bg-white/80 backdrop-blur-sm",maxLength:6,disabled:N}),(0,a.jsx)(S,{onClick:X,disabled:6!==g.length||N,className:"w-full h-12 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white text-lg font-medium rounded-xl shadow-lg",children:N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"连接中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{className:"w-5 h-5 mr-2"}),"获取文字"]})}),(v||f)&&(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("textarea",{value:v||f,readOnly:"receiver"!==o,onChange:"receiver"===o?O:void 0,className:"w-full min-h-[150px] p-4 border-2 border-emerald-200 rounded-xl bg-emerald-50/50 backdrop-blur-sm resize-none"}),"receiver"===o&&n&&(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1 bg-emerald-100 text-emerald-700 px-2 py-1 rounded-lg text-xs",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{children:"实时同步"})]})}),"receiver"===o&&!n&&(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1 bg-orange-100 text-orange-700 px-2 py-1 rounded-lg text-xs",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),(0,a.jsx)("span",{children:"连接中..."})]})})]}),(0,a.jsxs)(S,{onClick:()=>$(v||f),className:"w-full h-12 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white text-lg font-medium rounded-xl shadow-lg",children:[(0,a.jsx)(V.A,{className:"w-5 h-5 mr-2"}),"复制文字"]})]}),z.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-slate-800 mb-3 flex items-center",children:[(0,a.jsx)(F.A,{className:"w-5 h-5 mr-2"}),"接收到的图片 (",z.length,")"]}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:z.map((e,s)=>(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("img",{src:e,alt:"图片 ".concat(s+1),className:"w-full h-24 object-cover rounded-lg border-2 border-slate-200 hover:border-emerald-400 transition-colors cursor-pointer",onClick:()=>window.open(e,"_blank")}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-opacity rounded-lg"})]},s))})]})]})]})]})}var K=t(6683),H=t(4738),$=t(5690),Y=t(8979);function Z(e){let{onStartSharing:s,onStopSharing:t,onJoinSharing:i}=e,n=(0,r.useSearchParams)(),o=(0,r.useRouter)(),[d,c]=(0,l.useState)("share"),[m,x]=(0,l.useState)(""),[u,h]=(0,l.useState)(""),[f,p]=(0,l.useState)(!1),[g,b]=(0,l.useState)(!1),[v,j]=(0,l.useState)(!1),{showToast:N}=(0,G.d)();(0,l.useEffect)(()=>{let e=n.get("mode");"desktop"===n.get("type")&&e&&("send"===e?c("share"):"receive"===e&&c("view"))},[n]);let w=(0,l.useCallback)(e=>{c(e);let s=new URLSearchParams(n.toString());s.set("type","desktop"),s.set("mode","share"===e?"send":"receive"),o.push("?".concat(s.toString()),{scroll:!1})},[n,o]),y=(0,l.useCallback)(async()=>{if(s){j(!0);try{let e=await s();x(e),p(!0),N("桌面共享已开始！","success")}catch(e){console.error("开始共享失败:",e),N("开始共享失败，请重试","error")}finally{j(!1)}}},[s,N]),k=(0,l.useCallback)(async()=>{if(t){j(!0);try{await t(),p(!1),x(""),N("桌面共享已停止","success")}catch(e){console.error("停止共享失败:",e),N("停止共享失败","error")}finally{j(!1)}}},[t,N]),C=(0,l.useCallback)(async()=>{if(u.trim()&&i){j(!0);try{await i(u),b(!0),N("已连接到桌面共享！","success")}catch(e){console.error("连接失败:",e),N("连接失败，请检查连接码","error")}finally{j(!1)}}},[u,i,N]),A=(0,l.useCallback)(async e=>{try{await navigator.clipboard.writeText(e),N("已复制到剪贴板！","success")}catch(e){N("复制失败","error")}},[N]);return(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-center mb-6",children:(0,a.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-1 shadow-lg",children:[(0,a.jsxs)(S,{variant:"share"===d?"default":"ghost",onClick:()=>w("share"),className:"px-6 py-2 rounded-lg",children:[(0,a.jsx)(K.A,{className:"w-4 h-4 mr-2"}),"共享桌面"]}),(0,a.jsxs)(S,{variant:"view"===d?"default":"ghost",onClick:()=>w("view"),className:"px-6 py-2 rounded-lg",children:[(0,a.jsx)(H.A,{className:"w-4 h-4 mr-2"}),"观看桌面"]})]})}),"share"===d?(0,a.jsxs)("div",{className:"glass-card rounded-2xl p-4 sm:p-6 animate-fade-in-up",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-4 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center animate-float",children:(0,a.jsx)(K.A,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-semibold text-slate-800 mb-2",children:"共享桌面"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-slate-600",children:f?"桌面共享进行中":"开始共享您的桌面屏幕"})]}),(0,a.jsx)("div",{className:"space-y-4",children:f?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-purple-700 mb-2",children:"连接码"}),(0,a.jsx)("div",{className:"text-2xl font-bold font-mono text-purple-600 mb-3",children:m}),(0,a.jsxs)(S,{onClick:()=>A(m),size:"sm",className:"bg-purple-500 hover:bg-purple-600 text-white",children:[(0,a.jsx)(V.A,{className:"w-4 h-4 mr-2"}),"复制连接码"]})]})}),(0,a.jsx)(S,{onClick:k,disabled:v,className:"w-full h-12 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white text-lg font-medium rounded-xl shadow-lg",children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"停止中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Y.A,{className:"w-5 h-5 mr-2"}),"停止共享"]})})]}):(0,a.jsx)(S,{onClick:y,disabled:v,className:"w-full h-12 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white text-lg font-medium rounded-xl shadow-lg",children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"启动中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.A,{className:"w-5 h-5 mr-2"}),"开始共享桌面"]})})})]}):(0,a.jsxs)("div",{className:"glass-card rounded-2xl p-4 sm:p-6 animate-fade-in-up",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-4 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-2xl flex items-center justify-center animate-float",children:(0,a.jsx)(H.A,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-semibold text-slate-800 mb-2",children:"观看桌面"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-slate-600",children:g?"正在观看桌面共享":"输入连接码观看他人的桌面"})]}),(0,a.jsx)("div",{className:"space-y-4",children:g?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"aspect-video bg-slate-900 rounded-xl flex items-center justify-center text-white",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(H.A,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-sm opacity-75",children:"桌面共享画面"})]})}),(0,a.jsxs)(S,{onClick:()=>b(!1),className:"w-full h-12 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white text-lg font-medium rounded-xl shadow-lg",children:[(0,a.jsx)(Y.A,{className:"w-5 h-5 mr-2"}),"断开连接"]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M,{value:u,onChange:e=>h(e.target.value.toUpperCase().slice(0,6)),placeholder:"请输入连接码",className:"text-center text-2xl sm:text-3xl tracking-[0.3em] sm:tracking-[0.5em] font-mono h-12 sm:h-16 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:ring-indigo-500 bg-white/80 backdrop-blur-sm",maxLength:6,disabled:v}),(0,a.jsx)(S,{onClick:C,disabled:6!==u.length||v,className:"w-full h-12 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white text-lg font-medium rounded-xl shadow-lg",children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"连接中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(H.A,{className:"w-5 h-5 mr-2"}),"连接桌面"]})})]})})]})]})}var Q=t(9509);let ee=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{if(void 0!==Q&&Q.env)return Q.env[e]||s}catch(e){}return s},es={isDev:"development"===ee("NODE_ENV"),isProd:"production"===ee("NODE_ENV"),isStatic:!0,api:{backendUrl:ee("GO_BACKEND_URL","http://localhost:8080"),baseUrl:ee("NEXT_PUBLIC_API_BASE_URL","http://localhost:3000"),directBackendUrl:ee("NEXT_PUBLIC_BACKEND_URL","http://localhost:8080"),wsUrl:ee("NEXT_PUBLIC_WS_URL","ws://localhost:8080/ws")},timeout:{api:3e4,ws:6e4},retry:{max:3,delay:1e3}};var et=t(9509);async function ea(e){let s,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="true"===et.env.NEXT_EXPORT||!0;return s=a?function(e){let s=es.api.directBackendUrl.replace(/\/$/,""),t=e.startsWith("/")?e:"/".concat(e);return"".concat(s).concat(t)}(e):function(e){let s=es.api.baseUrl.replace(/\/$/,""),t=e.startsWith("/")?e:"/".concat(e);return"".concat(s).concat(t)}(e),console.log("[API] 模式检查: isClient=".concat(!0,", isStatic=").concat(a)),console.log("[API] 调用: ".concat(e," -> ").concat(s)),fetch(s,{...t,headers:{"Content-Type":"application/json",...t.headers}})}async function el(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ea(e,{...s,method:"GET"})}async function er(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return ea(e,{...t,method:"POST",body:s?JSON.stringify(s):void 0})}function ei(){let e=(0,r.useSearchParams)(),s=(0,r.useRouter)(),{websocket:t,isConnected:i,connect:n,disconnect:o,sendMessage:d}=function(){let[e,s]=(0,l.useState)(null),[t,a]=(0,l.useState)(!1),r=(0,l.useRef)(null),i=(0,l.useRef)(""),n=(0,l.useRef)("sender"),o=(0,l.useCallback)((t,l)=>{if(e&&e.readyState===WebSocket.OPEN&&i.current===t)return void console.log("WebSocket已连接，跳过重复连接");e&&e.close(),i.current=t,n.current=l;let d=es.api.wsUrl,c="".concat(d,"/p2p?code=").concat(t,"&role=").concat(l);console.log("连接WebSocket:",c);let m=new WebSocket(c);m.onopen=()=>{console.log("WebSocket连接已建立"),a(!0),s(m);let e={type:"connect",payload:{code:t,role:l,timestamp:Date.now()}};m.send(JSON.stringify(e))},m.onmessage=e=>{try{let s=JSON.parse(e.data);console.log("收到WebSocket消息:",s);let t=new CustomEvent("websocket-message",{detail:s});window.dispatchEvent(t)}catch(e){console.error("解析WebSocket消息失败:",e)}},m.onclose=e=>{console.log("WebSocket连接关闭:",e.code,e.reason),a(!1),s(null),1e3!==e.code&&i.current&&(console.log("尝试重新连接..."),r.current=setTimeout(()=>{o(i.current,n.current)},3e3))},m.onerror=e=>{console.error("WebSocket错误:",e)}},[e]),d=(0,l.useCallback)(()=>{r.current&&clearTimeout(r.current),i.current="",e&&e.close(1e3,"User disconnected")},[e]),c=(0,l.useCallback)(s=>{e&&e.readyState===WebSocket.OPEN?e.send(JSON.stringify(s)):console.warn("WebSocket未连接，无法发送消息")},[e]);return(0,l.useEffect)(()=>()=>{r.current&&clearTimeout(r.current),e&&e.close()},[e]),{websocket:e,isConnected:t,connect:o,disconnect:d,sendMessage:c}}(),{showToast:h}=(0,G.d)(),[f,g]=(0,l.useState)("file"),[b,k]=(0,l.useState)(!1),[C,A]=(0,l.useState)("");(0,l.useEffect)(()=>{let s=e.get("type");e.get("mode"),s&&["file","text","desktop"].includes(s)&&g(s)},[e]);let R=(0,l.useCallback)((t,a)=>{let l=new URLSearchParams(e.toString());l.set("type",t),a&&l.set("mode",a),s.push("?".concat(l.toString()),{scroll:!1})},[e,s]),[F,E]=(0,l.useState)([]),[D,U]=(0,l.useState)(""),[L,T]=(0,l.useState)(""),[M,P]=(0,l.useState)("sender"),[O,W]=(0,l.useState)([]),[J,V]=(0,l.useState)([]),[q,K]=(0,l.useState)(!1),[$,Y]=(0,l.useState)(null),[Q,ee]=(0,l.useState)(new Map),[et,ea]=(0,l.useState)(new Set),ei=(0,l.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";console.log("[".concat(s.toUpperCase(),"] ").concat(e)),h(e,s)},[h]),en=(0,l.useCallback)(e=>{if((i||D||q)&&e!==f){A(e),k(!0);return}g(e),R(e)},[R,i,D,q,f]);(0,l.useEffect)(()=>{i&&q&&(K(!1),console.log("WebSocket连接已建立，重置连接状态"))},[i,q]);let eo=(0,l.useCallback)(()=>{if(C){let e=window.location.origin+window.location.pathname,s="".concat(e,"?type=").concat(C);window.open(s,"_blank"),k(!1),A("")}},[C]),ed=(0,l.useCallback)(()=>{k(!1),A("")},[]),ec=(0,l.useCallback)(e=>{console.log("初始化文件传输:",e);let s=e.file_id;ee(t=>{let a=new Map(t);return a.set(s,{fileId:e.file_id,chunks:[],totalSize:e.size,receivedSize:0,fileName:e.name,mimeType:e.mime_type,startTime:Date.now()}),console.log("添加文件传输记录:",s),a}),V(s=>{let t=s.map(s=>s.fileId===e.file_id?{...s,status:"downloading",totalSize:e.size}:s);return console.log("更新传输进度为下载中:",t),t})},[]),em=(0,l.useCallback)((e,s)=>{s.chunks.sort((e,s)=>e.offset-s.offset);let t=new Uint8Array(s.chunks.reduce((e,s)=>e+s.data.length,0)),a=0;s.chunks.forEach(e=>{t.set(e.data,a),a+=e.data.length});let l=new Blob([t],{type:s.mimeType}),r=URL.createObjectURL(l),i=document.createElement("a");i.href=r,i.download=s.fileName,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),ee(s=>{let t=new Map(s);return t.delete(e),t}),V(s=>s.filter(s=>s.fileId!==e));let n=(Date.now()-s.startTime)/1e3,o=(s.totalSize/n/1024/1024).toFixed(2);ei('文件 "'.concat(s.fileName,'" 下载完成！传输速度: ').concat(o," MB/s"))},[ei]),ex=(0,l.useCallback)(e=>{console.log("接收文件数据块:",e);let s=e.file_id;ee(t=>{let a=new Map(t),l=a.get(s);if(l){if(l.receivedSize>=l.totalSize)return console.log("文件已完成，忽略额外的数据块"),a;let t=new Uint8Array(e.data);l.chunks.push({offset:e.offset,data:t}),l.receivedSize+=t.length,l.receivedSize>l.totalSize&&(l.receivedSize=l.totalSize);let r=l.receivedSize/l.totalSize*100;console.log("文件 ".concat(s," 进度: ").concat(r.toFixed(2),"%")),V(e=>{let t=e.map(e=>e.fileId===s?{...e,progress:r,receivedSize:l.receivedSize,totalSize:l.totalSize}:e);return console.log("更新进度状态:",t),t}),(e.is_last||l.receivedSize>=l.totalSize)&&(console.log("文件接收完成，准备下载"),V(e=>e.map(e=>e.fileId===s?{...e,status:"completed",progress:100,receivedSize:l.totalSize}:e)))}else console.warn("未找到对应的文件传输:",s);return a})},[]),eu=(0,l.useCallback)(e=>{if(console.log("文件传输完成，开始下载:",e),et.has(e))return void console.log("文件已经下载过，跳过重复下载:",e);ea(s=>new Set([...s,e]));let s=Q.get(e);s?(em(e,s),setTimeout(()=>{V(s=>s.filter(s=>s.fileId!==e))},2e3)):console.warn("未找到文件传输数据:",e)},[Q,em,et]),eh=(0,l.useCallback)(async e=>{let s=e.file_id,t=e.request_id,a=F[parseInt(s.replace("file_",""))];if(!a)return void console.error("未找到请求的文件:",s);console.log("开始发送文件:",a.name),ei("开始发送文件: ".concat(a.name)),d({type:"file-info",payload:{file_id:t,name:a.name,size:a.size,mime_type:a.type,last_modified:a.lastModified}});let l=0,r=()=>{if(l>=a.size){d({type:"file-complete",payload:{file_id:t}}),ei("文件发送完成: ".concat(a.name));return}let e=a.slice(l,l+65536),s=new FileReader;s.onload=e=>{var s;let i=null==(s=e.target)?void 0:s.result;d({type:"file-chunk",payload:{file_id:t,offset:l,data:Array.from(new Uint8Array(i)),is_last:l+i.byteLength>=a.size}}),l+=i.byteLength,setTimeout(r,10)},s.readAsArrayBuffer(e)};r()},[F,d,ei]);(0,l.useEffect)(()=>{let e=e=>{let s=e.detail;switch(console.log("HomePage收到WebSocket消息:",s.type,s),s.type){case"file-list":console.log("处理file-list消息"),"receiver"===M&&(W(s.payload.files||[]),K(!1));break;case"file-list-updated":console.log("处理file-list-updated消息"),"receiver"===M&&(W(s.payload.files||[]),ei("文件列表已更新，发现新文件！"));break;case"room-status":console.log("处理room-status消息"),Y(s.payload);break;case"file-info":console.log("处理file-info消息"),"receiver"===M&&ec(s.payload);break;case"file-chunk":console.log("处理file-chunk消息"),"receiver"===M&&ex(s.payload);break;case"file-complete":console.log("处理file-complete消息"),"receiver"===M&&eu(s.payload.file_id);break;case"file-request":console.log("处理file-request消息"),"sender"===M&&eh(s.payload)}};return window.addEventListener("websocket-message",e),()=>{window.removeEventListener("websocket-message",e)}},[M,ei,ec,ex,eu,eh]);let ef=(0,l.useCallback)(async()=>{if(0===F.length)return;let e=F.map((e,s)=>({id:"file_"+s,name:e.name,size:e.size,type:e.type,lastModified:e.lastModified}));try{let s=await er("/api/create-room",{files:e}),t=await s.json();if(t.success){let e=t.code;U(e),P("sender");let s=window.location.origin,a="".concat(s,"/?type=file&mode=receive&code=").concat(e);T(a),n(e,"sender"),ei("取件码生成成功！")}else ei("生成取件码失败: "+t.message,"error")}catch(e){console.error("生成取件码失败:",e),ei("生成取件码失败，请重试","error")}},[F,n,ei]),ep=(0,l.useCallback)(async e=>{if(q||i&&D===e)return void console.log("已在连接中或已连接，跳过重复请求");K(!0);try{let s=await el("/api/room-info?code=".concat(e)),t=await s.json();t.success?(U(e),P("receiver"),W(t.files||[]),n(e,"receiver"),ei("连接成功！","success")):(ei(t.message||"取件码无效或已过期","error"),K(!1))}catch(e){console.error("API调用失败:",e),ei("连接失败，请检查网络连接","error"),K(!1)}},[n,ei,q,i,D]);(0,l.useEffect)(()=>{let s=e.get("code");s&&6===s.length&&!i&&D!==s.toUpperCase()&&(P("receiver"),ep(s.toUpperCase()))},[e]);let eg=(0,l.useCallback)(e=>{var s;if(console.log("开始下载文件:",e),!t||t.readyState!==WebSocket.OPEN)return void ei("连接未建立，请重试","error");if(J.find(s=>s.originalFileId===e&&"completed"!==s.status)){console.log("文件已在下载中，跳过重复请求:",e),ei("文件正在下载中...","info");return}let a="req_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);console.log("生成请求ID:",a),d({type:"file-request",payload:{file_id:e,request_id:a}});let l={fileId:a,originalFileId:e,fileName:(null==(s=O.find(s=>s.id===e))?void 0:s.name)||e,progress:0,receivedSize:0,totalSize:0,status:"pending"};console.log("添加传输进度:",l),V(s=>[...s.filter(s=>s.originalFileId!==e),l])},[t,d,O,ei,J]),eb=(0,l.useCallback)(e=>{if(!D||!t||t.readyState!==WebSocket.OPEN)return void console.log("无法更新文件列表: pickupCode=",D,"websocket状态=",null==t?void 0:t.readyState);let s=e.map((e,s)=>({id:"file_"+s,name:e.name,size:e.size,type:e.type,lastModified:e.lastModified}));console.log("通过WebSocket发送文件列表更新:",s),d({type:"update-file-list",payload:{files:s}}),ei("文件列表已更新")},[D,t,d,ei]),ev=(0,l.useCallback)(e=>{D&&eb(e)},[D,eb]),ej=(0,l.useCallback)(()=>{E([]),V([]),ee(new Map),D&&(eb([]),ei("文件列表已清空，房间保持连接","success"))},[D,eb,ei]),eN=(0,l.useCallback)(()=>{E([]),U(""),T(""),W([]),V([]),Y(null),ee(new Map),o(),ei("已断开连接","info")},[o,ei]),ew=(0,l.useCallback)(async(e,s)=>{try{await navigator.clipboard.writeText(e),ei(s,"success")}catch(e){console.error("复制失败:",e),ei("复制失败，请手动复制","error")}},[ei]);return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[(0,a.jsxs)("div",{className:"relative min-h-screen",children:[(0,a.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,a.jsx)("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-blue-400/20 to-indigo-600/20 rounded-full blur-3xl"}),(0,a.jsx)("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-gradient-to-br from-purple-400/20 to-pink-400/20 rounded-full blur-3xl"})]}),(0,a.jsxs)("div",{className:"relative container mx-auto px-4 sm:px-6 py-8 max-w-6xl",children:[(0,a.jsx)(z,{}),(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)(c,{value:f,onValueChange:en,className:"w-full",children:[(0,a.jsxs)(m,{className:"grid w-full grid-cols-3 bg-white/80 backdrop-blur-sm border-0 shadow-lg h-12 sm:h-14 p-1 mb-6",children:[(0,a.jsxs)(x,{value:"file",className:"flex items-center justify-center space-x-2 text-sm sm:text-base font-medium data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-indigo-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300",children:[(0,a.jsx)(_.A,{className:"w-4 h-4 sm:w-5 sm:h-5"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"传文件"}),(0,a.jsx)("span",{className:"sm:hidden",children:"文件"})]}),(0,a.jsxs)(x,{value:"text",className:"flex items-center justify-center space-x-2 text-sm sm:text-base font-medium data-[state=active]:bg-gradient-to-r data-[state=active]:from-emerald-500 data-[state=active]:to-teal-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300",children:[(0,a.jsx)(I.A,{className:"w-4 h-4 sm:w-5 sm:h-5"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"传文字"}),(0,a.jsx)("span",{className:"sm:hidden",children:"文字"})]}),(0,a.jsxs)(x,{value:"desktop",className:"flex items-center justify-center space-x-2 text-sm sm:text-base font-medium data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-500 data-[state=active]:to-pink-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300",children:[(0,a.jsx)(H.A,{className:"w-4 h-4 sm:w-5 sm:h-5"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"共享桌面"}),(0,a.jsx)("span",{className:"sm:hidden",children:"桌面"})]})]}),(0,a.jsxs)(u,{value:"file",className:"mt-6 animate-fade-in-up",children:[(0,a.jsx)(B,{selectedFiles:F,onFilesChange:E,onGenerateCode:ef,pickupCode:D,pickupLink:L,onCopyCode:()=>ew(D,"取件码已复制到剪贴板！"),onCopyLink:()=>ew(L,"取件链接已复制到剪贴板！"),onAddMoreFiles:()=>{let e=document.createElement("input");e.type="file",e.multiple=!0,e.onchange=async e=>{let s=Array.from(e.target.files||[]),t=[...F,...s];E(t),D&&s.length>0&&eb(t)},e.click()},onRemoveFile:ev,onClearFiles:ej,onReset:eN,onJoinRoom:ep,receiverFiles:O,onDownloadFile:eg,transferProgresses:J,isConnected:i,isConnecting:q,disabled:q}),$&&"sender"===M&&(0,a.jsxs)("div",{className:"mt-6 glass-card rounded-2xl p-6 animate-fade-in-up",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-slate-800 mb-4 text-center",children:"实时状态"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"text-center p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl",children:[(0,a.jsx)("div",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:((null==$?void 0:$.sender_count)||0)+((null==$?void 0:$.receiver_count)||0)}),(0,a.jsx)("div",{className:"text-sm text-slate-600 mt-1",children:"在线用户"})]}),(0,a.jsxs)("div",{className:"text-center p-4 bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-emerald-600",children:(null==$?void 0:$.sender_count)||0}),(0,a.jsx)("div",{className:"text-sm text-slate-600 mt-1",children:"发送方"})]}),(0,a.jsxs)("div",{className:"text-center p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-purple-600",children:(null==$?void 0:$.receiver_count)||0}),(0,a.jsx)("div",{className:"text-sm text-slate-600 mt-1",children:"接收方"})]})]})]})]}),(0,a.jsx)(u,{value:"text",className:"mt-6 animate-fade-in-up",children:(0,a.jsx)(X,{onSendText:async e=>{try{let s=await fetch("/api/create-text-room",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})}),t=await s.json();if(!s.ok){let e=t.error||"创建文字传输房间失败";return ei(e,"error"),""}return ei("文字传输房间创建成功！","success"),t.code}catch(e){return console.error("创建文字传输房间失败:",e),ei("网络错误，请重试","error"),""}},onReceiveText:async e=>{try{let s=await fetch("/api/get-text-content",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}),t=await s.json();if(!s.ok){let e=t.error||"获取文字内容失败";return ei(e,"error"),""}return t.text}catch(e){return console.error("获取文字内容失败:",e),ei("网络错误，请重试","error"),""}},websocket:t,isConnected:i,currentRole:M,onCreateWebSocket:(e,s)=>{t&&o(),n(e,s)}})}),(0,a.jsx)(u,{value:"desktop",className:"mt-6 animate-fade-in-up",children:(0,a.jsx)(Z,{onStartSharing:async()=>(ei("桌面共享功能开发中","info"),"DEF456"),onStopSharing:async()=>{ei("桌面共享已停止","info")},onJoinSharing:async e=>{ei("桌面共享功能开发中","info")}})})]})}),(0,a.jsx)("div",{className:"h-8 sm:h-16"})]})]}),(0,a.jsx)(p,{open:b,onOpenChange:k,children:(0,a.jsxs)(v,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(j,{children:[(0,a.jsx)(w,{children:"切换传输模式"}),(0,a.jsx)(y,{children:(()=>{let e="",s="";switch(f){case"file":e="文件传输";break;case"text":e="文字传输";break;case"desktop":e="桌面共享"}switch(C){case"file":s="文件传输";break;case"text":s="文字传输";break;case"desktop":s="桌面共享"}return"当前".concat(e,"会话进行中，是否要在新标签页中打开").concat(s,"？")})()})]}),(0,a.jsxs)(N,{children:[(0,a.jsx)(S,{variant:"outline",onClick:ed,children:"取消"}),(0,a.jsx)(S,{onClick:eo,children:"确认打开"})]})]})})]})}let en=function(){return(0,a.jsx)(l.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"加载中..."}),children:(0,a.jsx)(ei,{})})}},6801:(e,s,t)=>{"use strict";t.d(s,{ToastProvider:()=>n,d:()=>i});var a=t(5155),l=t(2115);let r=(0,l.createContext)(void 0),i=()=>{let e=(0,l.useContext)(r);if(!e)throw Error("useToast must be used within a ToastProvider");return e},n=e=>{let{children:s}=e,[t,i]=(0,l.useState)([]),n=(0,l.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",t=Date.now().toString(),a={id:t,message:e,type:s};i(e=>[...e,a]),setTimeout(()=>{i(e=>e.filter(e=>e.id!==t))},3e3)},[]),o=(0,l.useCallback)(e=>{i(s=>s.filter(s=>s.id!==e))},[]);return(0,a.jsxs)(r.Provider,{value:{showToast:n},children:[s,(0,a.jsx)("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 space-y-2",children:t.map(e=>(0,a.jsx)("div",{className:"\n              max-w-sm p-4 rounded-xl shadow-lg backdrop-blur-sm transform transition-all duration-300 ease-in-out\n              ".concat("success"===e.type?"bg-emerald-50/90 border border-emerald-200 text-emerald-800":"","\n              ").concat("error"===e.type?"bg-red-50/90 border border-red-200 text-red-800":"","\n              ").concat("info"===e.type?"bg-blue-50/90 border border-blue-200 text-blue-800":"","\n              animate-slide-in-down\n            "),onClick:()=>o(e.id),children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"flex-shrink-0",children:["success"===e.type&&(0,a.jsx)("div",{className:"w-6 h-6 bg-emerald-500 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),"error"===e.type&&(0,a.jsx)("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),"info"===e.type&&(0,a.jsx)("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})})]}),(0,a.jsx)("p",{className:"text-sm font-medium",children:e.message})]})},e.id))})]})}}},e=>{e.O(0,[660,441,964,358],()=>e(e.s=409)),_N_E=e.O()}]);